 - hosts: all
   name: Patch  Redhat system 
   gather_facts: false
   become_user: root
   become_method: sudo
   #ansible_host_key_checking: false
   tasks:
     - name: "Copy Patch script From local system to all managed  nodes "
       copy:
          src: /home/arvind/kumar/linux.sh 
          dest: /tmp
          owner: root
          mode: 0777
     - name: "using shell module for executing script "
       shell: ./linux.sh >> /home/arvind/update.txt
       args:
          chdir: /tmp
       register: result
       
     - debug:  
         var: result
    
     # this task is to wait for 1  minutues for system to come up after the reboot
     - name: pause for 2 minute
       pause:
       minutes: 2
   
    # this task is to confirm,system is up and responding to ssh
     - name: check if system responding to ssh
       local_action:
          module: wait_for
              host={{ inventory_hostname }}
              port=22
              delay=15
              timeout=300
              state=started
              # when: reboot_started|changed
                                                                                                                                                                                   
      # Ensure Jboss service is running 
     - name: insure jboss service is running 
       service: name=httpd state=started enabled=yes
       register: status
     - debug:
            var: status 
